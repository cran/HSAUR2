
R version 2.9.0 (2009-04-17)
Copyright (C) 2009 The R Foundation for Statistical Computing
ISBN 3-900051-07-0

R is free software and comes with ABSOLUTELY NO WARRANTY.
You are welcome to redistribute it under certain conditions.
Type 'license()' or 'licence()' for distribution details.

R is a collaborative project with many contributors.
Type 'contributors()' for more information and
'citation()' on how to cite R or R packages in publications.

Type 'demo()' for some demos, 'help()' for on-line help, or
'help.start()' for an HTML browser interface to help.
Type 'q()' to quit R.

> ###################################################
> ### chunk number 1: setup
> ###################################################
> rm(list = ls())
> if (!file.exists("tables")) dir.create("tables")
> set.seed(290875)
> options(prompt = "R> ", continue = "+  ",
+     width = 63, # digits = 4,
+     show.signif.stars = FALSE,
+     SweaveHooks = list(leftpar = function()
+         par(mai = par("mai") * c(1, 1.05, 1, 1)),
+         bigleftpar = function()
+         par(mai = par("mai") * c(1, 1.7, 1, 1))))
R> HSAURpkg <- require("HSAUR2")
Loading required package: HSAUR2
Loading required package: lattice
Loading required package: MASS
Loading required package: scatterplot3d
R> if (!HSAURpkg) stop("cannot load package ", sQuote("HSAUR2"))
R> rm(HSAURpkg)
R>  ### </FIXME> hm, R-2.4.0 --vanilla seems to need this
R> a <- Sys.setlocale("LC_ALL", "C")
R>  ### </FIXME>
R> book <- TRUE
R> refs <- cbind(c("AItR", "DAGD", "SI", "CI", "ANOVA", "MLR", "GLM",
+                  "DE", "RP", "GAM", "SA", "ALDI", "ALDII", "SIMC", "MA", "PCA",
+                  "MDS", "CA"), 1:18)
R> ch <- function(x) {
+      ch <- refs[which(refs[,1] == x),]
+      if (book) {
+          return(paste("Chapter~\\\\ref{", ch[1], "}", sep = ""))
+      } else {
+          return(paste("Chapter~", ch[2], sep = ""))
+      }
+  }
R> if (file.exists("deparse.R"))
+      source("deparse.R")
R> setHook(packageEvent("lattice", "attach"), function(...) {
+      lattice.options(default.theme =
+          function()
+              standard.theme("pdf", color = FALSE))
+      })
R> 
R> 
R> ###################################################
R> ### chunk number 2: singlebook
R> ###################################################
R> book <- FALSE
R> 
R> 
R> ###################################################
R> ### chunk number 3: ALDI-setup
R> ###################################################
R> library("Matrix")

Attaching package: 'Matrix'


	The following object(s) are masked from package:stats :

	 xtabs 


	The following object(s) are masked from package:base :

	 rcond 

R> library("lme4")
R> library("multcomp")
Loading required package: mvtnorm
Loading required package: survival
Loading required package: splines
R>  ### fix bug in lme4 0.9975-1 (for the time being)
R> residuals <- function(object) object@y - fitted(object)
R> 
R> 
R> ###################################################
R> ### chunk number 4: ALDI-plot-BtheB
R> ###################################################
R> data("BtheB", package = "HSAUR2")
R> layout(matrix(1:2, nrow = 1))
R> ylim <- range(BtheB[,grep("bdi", names(BtheB))],
+                na.rm = TRUE)
R> tau <- subset(BtheB, treatment == "TAU")[,
+      grep("bdi", names(BtheB))]
R> boxplot(tau, main = "Treated as Usual", ylab = "BDI",
+          xlab = "Time (in months)", names = c(0, 2, 3, 5, 8),
+          ylim = ylim)
R> btheb <- subset(BtheB, treatment == "BtheB")[,
+      grep("bdi", names(BtheB))]
R> boxplot(btheb, main = "Beat the Blues", ylab = "BDI",
+          xlab = "Time (in months)", names = c(0, 2, 3, 5, 8),
+          ylim = ylim)
R> 
R> 
R> ###################################################
R> ### chunk number 5: ALDI-long-BtheB
R> ###################################################
R> data("BtheB", package = "HSAUR2")
R> BtheB$subject <- factor(rownames(BtheB))
R> nobs <- nrow(BtheB)
R> BtheB_long <- reshape(BtheB, idvar = "subject",
+      varying = c("bdi.2m", "bdi.3m", "bdi.5m", "bdi.8m"),
+      direction = "long")
R> BtheB_long$time <- rep(c(2, 3, 5, 8), rep(nobs, 4))
R> 
R> 
R> ###################################################
R> ### chunk number 6: ALDI-showlong-BtheB
R> ###################################################
R> subset(BtheB_long, subject %in% c("1", "2", "3"))
     drug length treatment bdi.pre subject time bdi
1.2m   No    >6m       TAU      29       1    2   2
2.2m  Yes    >6m     BtheB      32       2    2  16
3.2m  Yes    <6m       TAU      25       3    2  20
1.3m   No    >6m       TAU      29       1    3   2
2.3m  Yes    >6m     BtheB      32       2    3  24
3.3m  Yes    <6m       TAU      25       3    3  NA
1.5m   No    >6m       TAU      29       1    5  NA
2.5m  Yes    >6m     BtheB      32       2    5  17
3.5m  Yes    <6m       TAU      25       3    5  NA
1.8m   No    >6m       TAU      29       1    8  NA
2.8m  Yes    >6m     BtheB      32       2    8  20
3.8m  Yes    <6m       TAU      25       3    8  NA
R> 
R> 
R> ###################################################
R> ### chunk number 7: ALDI-fit-BtheB
R> ###################################################
R> library("lme4")
R> BtheB_lmer1 <- lmer(bdi ~ bdi.pre + time + treatment + drug +
+      length + (1 | subject), data = BtheB_long,
+      REML = FALSE, na.action = na.omit)
R> BtheB_lmer2 <- lmer(bdi ~ bdi.pre + time + treatment + drug +
+      length + (time | subject), data = BtheB_long,
+      REML = FALSE, na.action = na.omit)
R> anova(BtheB_lmer1, BtheB_lmer2)
Data: BtheB_long
Models:
BtheB_lmer1: bdi ~ bdi.pre + time + treatment + drug + length + (1 | subject)
BtheB_lmer2: bdi ~ bdi.pre + time + treatment + drug + length + (time | subject)
            Df     AIC     BIC  logLik  Chisq Chi Df
BtheB_lmer1  8 1887.49 1916.57 -935.75              
BtheB_lmer2 10 1891.04 1927.39 -935.52 0.4542      2
            Pr(>Chisq)
BtheB_lmer1           
BtheB_lmer2     0.7969
R> 
R> 
R> ###################################################
R> ### chunk number 8: ALDI-summary-BtheB
R> ###################################################
R> summary(BtheB_lmer1)
Linear mixed model fit by maximum likelihood 
Formula: bdi ~ bdi.pre + time + treatment + drug + length + (1 | subject) 
   Data: BtheB_long 
  AIC  BIC logLik deviance REMLdev
 1887 1917 -935.7     1871    1867
Random effects:
 Groups   Name        Variance Std.Dev.
 subject  (Intercept) 48.777   6.9841  
 Residual             25.140   5.0140  
Number of obs: 280, groups: subject, 97

Fixed effects:
               Estimate Std. Error t value
(Intercept)     5.59244    2.24232   2.494
bdi.pre         0.63967    0.07789   8.213
time           -0.70477    0.14639  -4.814
treatmentBtheB -2.32912    1.67026  -1.394
drugYes        -2.82497    1.72674  -1.636
length>6m       0.19712    1.63823   0.120

Correlation of Fixed Effects:
            (Intr) bdi.pr time   trtmBB drugYs
bdi.pre     -0.682                            
time        -0.238  0.020                     
tretmntBthB -0.390  0.121  0.018              
drugYes     -0.073 -0.237 -0.022 -0.323       
length>6m   -0.243 -0.242 -0.036  0.002  0.157
R> 
R> 
R> ###################################################
R> ### chunk number 9: ALDI-summary-BtheB-p
R> ###################################################
R> cftest(BtheB_lmer1)

	 Simultaneous Tests for General Linear Hypotheses

Fit: lmer(formula = bdi ~ bdi.pre + time + treatment + drug + length + 
    (1 | subject), data = BtheB_long, REML = FALSE, na.action = na.omit)

Linear Hypotheses:
                    Estimate Std. Error z value Pr(>|z|)
(Intercept) == 0     5.59244    2.24232   2.494   0.0126
bdi.pre == 0         0.63967    0.07789   8.213 2.22e-16
time == 0           -0.70477    0.14639  -4.814 1.48e-06
treatmentBtheB == 0 -2.32912    1.67026  -1.394   0.1632
drugYes == 0        -2.82497    1.72674  -1.636   0.1018
length>6m == 0       0.19712    1.63823   0.120   0.9042
(Univariate p values reported)

R> 
R> 
R> ###################################################
R> ### chunk number 10: ALDI-qqnorm-BtheB
R> ###################################################
R> layout(matrix(1:2, ncol = 2))
R> qint <- ranef(BtheB_lmer1)$subject[["(Intercept)"]]
R> qres <- residuals(BtheB_lmer1)
R> qqnorm(qint, ylab = "Estimated random intercepts",
+         xlim = c(-3, 3), ylim = c(-20, 20),
+         main = "Random intercepts")
R> qqline(qint)
R> qqnorm(qres, xlim = c(-3, 3), ylim = c(-20, 20),
+         ylab = "Estimated residuals",
+         main = "Residuals")
R> qqline(qres)
R> 
R> 
R> 
