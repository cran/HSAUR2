
R version 2.9.0 (2009-04-17)
Copyright (C) 2009 The R Foundation for Statistical Computing
ISBN 3-900051-07-0

R is free software and comes with ABSOLUTELY NO WARRANTY.
You are welcome to redistribute it under certain conditions.
Type 'license()' or 'licence()' for distribution details.

R is a collaborative project with many contributors.
Type 'contributors()' for more information and
'citation()' on how to cite R or R packages in publications.

Type 'demo()' for some demos, 'help()' for on-line help, or
'help.start()' for an HTML browser interface to help.
Type 'q()' to quit R.

> ###################################################
> ### chunk number 1: setup
> ###################################################
> rm(list = ls())
> if (!file.exists("tables")) dir.create("tables")
> set.seed(290875)
> options(prompt = "R> ", continue = "+  ",
+     width = 63, # digits = 4,
+     show.signif.stars = FALSE,
+     SweaveHooks = list(leftpar = function()
+         par(mai = par("mai") * c(1, 1.05, 1, 1)),
+         bigleftpar = function()
+         par(mai = par("mai") * c(1, 1.7, 1, 1))))
R> HSAURpkg <- require("HSAUR2")
Loading required package: HSAUR2
Loading required package: lattice
Loading required package: MASS
Loading required package: scatterplot3d
R> if (!HSAURpkg) stop("cannot load package ", sQuote("HSAUR2"))
R> rm(HSAURpkg)
R>  ### </FIXME> hm, R-2.4.0 --vanilla seems to need this
R> a <- Sys.setlocale("LC_ALL", "C")
R>  ### </FIXME>
R> book <- TRUE
R> refs <- cbind(c("AItR", "DAGD", "SI", "CI", "ANOVA", "MLR", "GLM",
+                  "DE", "RP", "GAM", "SA", "ALDI", "ALDII", "SIMC", "MA", "PCA",
+                  "MDS", "CA"), 1:18)
R> ch <- function(x) {
+      ch <- refs[which(refs[,1] == x),]
+      if (book) {
+          return(paste("Chapter~\\\\ref{", ch[1], "}", sep = ""))
+      } else {
+          return(paste("Chapter~", ch[2], sep = ""))
+      }
+  }
R> if (file.exists("deparse.R"))
+      source("deparse.R")
R> setHook(packageEvent("lattice", "attach"), function(...) {
+      lattice.options(default.theme =
+          function()
+              standard.theme("pdf", color = FALSE))
+      })
R> 
R> 
R> ###################################################
R> ### chunk number 2: singlebook
R> ###################################################
R> book <- FALSE
R> 
R> 
R> ###################################################
R> ### chunk number 3: SA-setup
R> ###################################################
R> x <- library("survival")
Loading required package: splines
R> x <- library("coin")
Loading required package: mvtnorm
Loading required package: modeltools
Loading required package: stats4
R> x <- library("party")
Loading required package: grid
Loading required package: zoo

Attaching package: 'zoo'


	The following object(s) are masked from package:base :

	 as.Date.numeric 

Loading required package: sandwich
Loading required package: strucchange
Loading required package: vcd
Loading required package: colorspace
R> 
R> 
R> ###################################################
R> ### chunk number 4: SA-glioma-KM
R> ###################################################
R> data("glioma", package = "coin")
R> library("survival")
R> layout(matrix(1:2, ncol = 2))
R> g3 <- subset(glioma, histology == "Grade3")
R> plot(survfit(Surv(time, event) ~ group, data = g3),
+       main = "Grade III Glioma", lty = c(2, 1),
+       ylab = "Probability", xlab = "Survival Time in Month",
+       legend.text = c("Control", "Treated"),
+       legend.bty = "n")
There were 12 warnings (use warnings() to see them)
R> g4 <- subset(glioma, histology == "GBM")
R> plot(survfit(Surv(time, event) ~ group, data = g4),
+       main = "Grade IV Glioma", ylab = "Probability",
+       lty = c(2, 1), xlab = "Survival Time in Month",
+       xlim = c(0, max(glioma$time) * 1.05))
R> 
R> 
R> ###################################################
R> ### chunk number 5: SA-glioma-logrank
R> ###################################################
R> survdiff(Surv(time, event) ~ group, data = g3)
Call:
survdiff(formula = Surv(time, event) ~ group, data = g3)

               N Observed Expected (O-E)^2/E (O-E)^2/V
group=Control  6        4     1.49      4.23      6.06
group=RIT     11        2     4.51      1.40      6.06

 Chisq= 6.1  on 1 degrees of freedom, p= 0.0138 
R> 
R> 
R> ###################################################
R> ### chunk number 6: SA-glioma-exact
R> ###################################################
R> library("coin")
R> surv_test(Surv(time, event) ~ group, data = g3,
+            distribution = "exact")

	Exact Logrank Test

data:  Surv(time, event) by group (Control, RIT) 
Z = 2.1711, p-value = 0.02877
alternative hypothesis: two.sided 

R> 
R> 
R> ###################################################
R> ### chunk number 7: SA-glioma-g4
R> ###################################################
R> surv_test(Surv(time, event) ~ group, data = g4,
+            distribution = "exact")

	Exact Logrank Test

data:  Surv(time, event) by group (Control, RIT) 
Z = 3.2215, p-value = 0.0001588
alternative hypothesis: two.sided 

R> 
R> 
R> ###################################################
R> ### chunk number 8: SA-glioma-hist
R> ###################################################
R> surv_test(Surv(time, event) ~ group | histology,
+      data = glioma, distribution = approximate(B = 10000))

	Approximative Logrank Test

data:  Surv(time, event) by
	 group (Control, RIT) 
	 stratified by histology 
Z = 3.6704, p-value = 1e-04
alternative hypothesis: two.sided 

R> 
R> 
R> ###################################################
R> ### chunk number 9: SA-GBSG2-plot
R> ###################################################
R> data("GBSG2", package = "ipred")
R> plot(survfit(Surv(time, cens) ~ horTh, data = GBSG2),
+       lty = 1:2, mark.time = FALSE, ylab = "Probability",
+       xlab = "Survival Time in Days")
R> legend(250, 0.2, legend = c("yes", "no"), lty = c(2, 1),
+         title = "Hormonal Therapy", bty = "n")
R> 
R> 
R> ###################################################
R> ### chunk number 10: SA-GBSG2-coxph
R> ###################################################
R> GBSG2_coxph <- coxph(Surv(time, cens) ~ ., data = GBSG2)
R> 
R> 
R> ###################################################
R> ### chunk number 11: SA-GBSG2-coxph-ci
R> ###################################################
R> ci <- confint(GBSG2_coxph)
R> exp(cbind(coef(GBSG2_coxph), ci))["horThyes",]
              2.5 %    97.5 % 
0.7073155 0.5492178 0.9109233 
R> 
R> 
R> ###################################################
R> ### chunk number 12: GBSG2-coxph-summary
R> ###################################################
R> summary(GBSG2_coxph)
Call:
coxph(formula = Surv(time, cens) ~ ., data = GBSG2)

  n= 686 

                   coef  exp(coef)   se(coef)      z Pr(>|z|)
horThyes     -0.3462784  0.7073155  0.1290747 -2.683 0.007301
age          -0.0094592  0.9905854  0.0093006 -1.017 0.309126
menostatPost  0.2584448  1.2949147  0.1834765  1.409 0.158954
tsize         0.0077961  1.0078266  0.0039390  1.979 0.047794
tgrade.L      0.5512988  1.7355056  0.1898441  2.904 0.003685
tgrade.Q     -0.2010905  0.8178384  0.1219654 -1.649 0.099199
pnodes        0.0487886  1.0499984  0.0074471  6.551  5.7e-11
progrec      -0.0022172  0.9977852  0.0005735 -3.866 0.000111
estrec        0.0001973  1.0001973  0.0004504  0.438 0.661307

             exp(coef) exp(-coef) lower .95 upper .95
horThyes        0.7073     1.4138    0.5492     0.911
age             0.9906     1.0095    0.9727     1.009
menostatPost    1.2949     0.7723    0.9038     1.855
tsize           1.0078     0.9922    1.0001     1.016
tgrade.L        1.7355     0.5762    1.1963     2.518
tgrade.Q        0.8178     1.2227    0.6439     1.039
pnodes          1.0500     0.9524    1.0348     1.065
progrec         0.9978     1.0022    0.9967     0.999
estrec          1.0002     0.9998    0.9993     1.001

Rsquare= 0.142   (max possible= 0.995 )
Likelihood ratio test= 104.8  on 9 df,   p=0
Wald test            = 114.8  on 9 df,   p=0
Score (logrank) test = 120.7  on 9 df,   p=0

R> 
R> 
R> ###################################################
R> ### chunk number 13: SA-GBSG2-zph
R> ###################################################
R> GBSG2_zph <- cox.zph(GBSG2_coxph)
R> GBSG2_zph
                   rho    chisq       p
horThyes     -2.54e-02 1.96e-01 0.65778
age           9.40e-02 2.96e+00 0.08552
menostatPost -1.19e-05 3.75e-08 0.99985
tsize        -2.50e-02 1.88e-01 0.66436
tgrade.L     -1.30e-01 4.85e+00 0.02772
tgrade.Q      3.22e-03 3.14e-03 0.95530
pnodes        5.84e-02 5.98e-01 0.43941
progrec       5.65e-02 1.20e+00 0.27351
estrec        5.46e-02 1.03e+00 0.30967
GLOBAL              NA 2.27e+01 0.00695
R> 
R> 
R> ###################################################
R> ### chunk number 14: SA-GBSG2-zph-plot
R> ###################################################
R> plot(GBSG2_zph, var = "age")
Warning messages:
1: In approx(xx, xtime, seq(min(xx), max(xx), length = 17)[2 * (1:8)]) :
  collapsing to unique 'x' values
2: In approx(xtime, xx, temp) : collapsing to unique 'x' values
R> 
R> 
R> ###################################################
R> ### chunk number 15: SA-GBSG2-Martingal
R> ###################################################
R> layout(matrix(1:3, ncol = 3))
R> res <- residuals(GBSG2_coxph)
R> plot(res ~ age, data = GBSG2, ylim = c(-2.5, 1.5),
+       pch = ".", ylab = "Martingale Residuals")
R> abline(h = 0, lty = 3)
R> plot(res ~ pnodes, data = GBSG2, ylim = c(-2.5, 1.5),
+       pch = ".", ylab = "")
R> abline(h = 0, lty = 3)
R> plot(res ~ log(progrec), data = GBSG2, ylim = c(-2.5, 1.5),
+       pch = ".", ylab = "")
R> abline(h = 0, lty = 3)
R> 
R> 
R> ###################################################
R> ### chunk number 16: SA-GBSG2-ctree
R> ###################################################
R> GBSG2_ctree <- ctree(Surv(time, cens) ~ ., data = GBSG2)
R> 
R> 
R> ###################################################
R> ### chunk number 17: SA-GBSG2-ctree-plot
R> ###################################################
R> plot(GBSG2_ctree)
R> 
R> 
R> 
