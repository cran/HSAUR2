
R version 2.9.0 (2009-04-17)
Copyright (C) 2009 The R Foundation for Statistical Computing
ISBN 3-900051-07-0

R is free software and comes with ABSOLUTELY NO WARRANTY.
You are welcome to redistribute it under certain conditions.
Type 'license()' or 'licence()' for distribution details.

R is a collaborative project with many contributors.
Type 'contributors()' for more information and
'citation()' on how to cite R or R packages in publications.

Type 'demo()' for some demos, 'help()' for on-line help, or
'help.start()' for an HTML browser interface to help.
Type 'q()' to quit R.

> ###################################################
> ### chunk number 1: setup
> ###################################################
> rm(list = ls())
> if (!file.exists("tables")) dir.create("tables")
> set.seed(290875)
> options(prompt = "R> ", continue = "+  ",
+     width = 63, # digits = 4,
+     show.signif.stars = FALSE,
+     SweaveHooks = list(leftpar = function()
+         par(mai = par("mai") * c(1, 1.05, 1, 1)),
+         bigleftpar = function()
+         par(mai = par("mai") * c(1, 1.7, 1, 1))))
R> HSAURpkg <- require("HSAUR2")
Loading required package: HSAUR2
Loading required package: lattice
Loading required package: MASS
Loading required package: scatterplot3d
R> if (!HSAURpkg) stop("cannot load package ", sQuote("HSAUR2"))
R> rm(HSAURpkg)
R>  ### </FIXME> hm, R-2.4.0 --vanilla seems to need this
R> a <- Sys.setlocale("LC_ALL", "C")
R>  ### </FIXME>
R> book <- TRUE
R> refs <- cbind(c("AItR", "DAGD", "SI", "CI", "ANOVA", "MLR", "GLM",
+                  "DE", "RP", "GAM", "SA", "ALDI", "ALDII", "SIMC", "MA", "PCA",
+                  "MDS", "CA"), 1:18)
R> ch <- function(x) {
+      ch <- refs[which(refs[,1] == x),]
+      if (book) {
+          return(paste("Chapter~\\\\ref{", ch[1], "}", sep = ""))
+      } else {
+          return(paste("Chapter~", ch[2], sep = ""))
+      }
+  }
R> if (file.exists("deparse.R"))
+      source("deparse.R")
R> setHook(packageEvent("lattice", "attach"), function(...) {
+      lattice.options(default.theme =
+          function()
+              standard.theme("pdf", color = FALSE))
+      })
R> 
R> 
R> ###################################################
R> ### chunk number 2: singlebook
R> ###################################################
R> book <- FALSE
R> 
R> 
R> ###################################################
R> ### chunk number 3: CI-roomwidth-ties
R> ###################################################
R> data("roomwidth", package = "HSAUR2")
R> nobs <- table(roomwidth$unit)
R> ties <- tapply(roomwidth$width, roomwidth$unit, function(x) length(x) - length(unique(x)))
R> library("coin")
Loading required package: survival
Loading required package: splines
Loading required package: mvtnorm
Loading required package: modeltools
Loading required package: stats4
R> 
R> 
R> ###################################################
R> ### chunk number 4: CI-roomwidth-data
R> ###################################################
R> data("roomwidth", package = "HSAUR2")
R> convert <- ifelse(roomwidth$unit == "feet", 1, 3.28)
R> feet <- roomwidth$unit == "feet"
R> metre <- !feet
R> y <- roomwidth$width * convert
R> 
R> 
R> ###################################################
R> ### chunk number 5: CI-roomwidth-teststat
R> ###################################################
R> T <- mean(y[feet]) - mean(y[metre])
R> T
[1] -8.858893
R> 
R> 
R> ###################################################
R> ### chunk number 6: CI-roomwidth-permutation
R> ###################################################
R> meandiffs <- double(9999)
R> for (i in 1:length(meandiffs)) {
+      sy <- sample(y)
+      meandiffs[i] <- mean(sy[feet]) - mean(sy[metre])
+  }
R> 
R> 
R> ###################################################
R> ### chunk number 7: CI-roomwidth-plot
R> ###################################################
R> hist(meandiffs)
R> abline(v = T, lty = 2)
R> abline(v = -T, lty = 2)
R> 
R> 
R> ###################################################
R> ### chunk number 8: CI-roomwidth-pvalue
R> ###################################################
R> greater <- abs(meandiffs) > abs(T)
R> mean(greater)
[1] 0.0080008
R> 
R> 
R> ###################################################
R> ### chunk number 9: CI-roomwidth-pvalue
R> ###################################################
R> binom.test(sum(greater), length(greater))$conf.int
[1] 0.006349087 0.009947933
attr(,"conf.level")
[1] 0.95
R> 
R> 
R> ###################################################
R> ### chunk number 10: CI-roomwidth-coin
R> ###################################################
R> library("coin")
R> independence_test(y ~ unit, data = roomwidth,
+                    distribution = exact())

	Exact General Independence Test

data:  y by unit (feet, metres) 
Z = -2.5491, p-value = 0.008492
alternative hypothesis: two.sided 

R> 
R> 
R> ###################################################
R> ### chunk number 11: CI-roomwidth-coin
R> ###################################################
R> wilcox_test(y ~ unit, data = roomwidth,
+              distribution = exact())

	Exact Wilcoxon Mann-Whitney Rank Sum Test

data:  y by unit (feet, metres) 
Z = -2.1981, p-value = 0.02763
alternative hypothesis: true mu is not equal to 0 

R> 
R> 
R> ###################################################
R> ### chunk number 12: CI-suicides-ft
R> ###################################################
R> data("suicides", package = "HSAUR2")
R> fisher.test(suicides)

	Fisher's Exact Test for Count Data

data:  suicides 
p-value = 0.0805
alternative hypothesis: true odds ratio is not equal to 1 
95 percent confidence interval:
  0.7306872 91.0288231 
sample estimates:
odds ratio 
  6.302622 

R> 
R> 
R> ###################################################
R> ### chunk number 13: CI-suicides-chisq
R> ###################################################
R> ftp <- round(fisher.test(suicides)$p.value, 3)
R> ctp <- round(chisq.test(suicides)$p.value, 3)
Warning message:
In chisq.test(suicides) : Chi-squared approximation may be incorrect
R> 
R> 
R> ###################################################
R> ### chunk number 14: CI-Lanza-data
R> ###################################################
R> data("Lanza", package = "HSAUR2")
R> xtabs(~ treatment + classification + study, data = Lanza)
, , study = I

             classification
treatment      1  2  3  4  5
  Misoprostol 21  2  4  2  0
  Placebo      2  2  4  9 13

, , study = II

             classification
treatment      1  2  3  4  5
  Misoprostol 20  4  6  0  0
  Placebo      8  4  9  4  5

, , study = III

             classification
treatment      1  2  3  4  5
  Misoprostol 20  4  3  1  2
  Placebo      0  2  5  5 17

, , study = IV

             classification
treatment      1  2  3  4  5
  Misoprostol  1  4  5  0  0
  Placebo      0  0  0  4  6

R> 
R> 
R> ###################################################
R> ### chunk number 15: CI-width
R> ###################################################
R> options(width = 65)
R> 
R> 
R> ###################################################
R> ### chunk number 16: CI-Lanza-singleI
R> ###################################################
R> library("coin")
R> cmh_test(classification ~ treatment, data = Lanza,
+           scores = list(classification = c(0, 1, 6, 17, 30)),
+           subset = Lanza$study == "I")

	Asymptotic Linear-by-Linear Association Test

data:  classification (ordered) by treatment (Misoprostol, Placebo) 
chi-squared = 28.8478, df = 1, p-value = 7.83e-08

R> 
R> 
R> ###################################################
R> ### chunk number 17: CI-Lanza-singleII
R> ###################################################
R> cmh_test(classification ~ treatment, data = Lanza,
+           scores = list(classification = c(0, 1, 6, 17, 30)),
+           subset = Lanza$study == "II")

	Asymptotic Linear-by-Linear Association Test

data:  classification (ordered) by treatment (Misoprostol, Placebo) 
chi-squared = 12.0641, df = 1, p-value = 0.000514

R> 
R> 
R> ###################################################
R> ### chunk number 18: CI-Lanza-singleIIa
R> ###################################################
R> p <- cmh_test(classification ~ treatment, data = Lanza,
+           scores = list(classification = c(0, 1, 6, 17, 30)),
+           subset = Lanza$study == "II", distribution =
+           approximate(B = 19999))
R> pvalue(p)
[1] 5.00025e-05
99 percent confidence interval:
 2.506396e-07 3.714653e-04 

R> 
R> 
R> ###################################################
R> ### chunk number 19: CI-Lanza-singleIII-IV
R> ###################################################
R> cmh_test(classification ~ treatment, data = Lanza,
+           scores = list(classification = c(0, 1, 6, 17, 30)),
+           subset = Lanza$study == "III")

	Asymptotic Linear-by-Linear Association Test

data:  classification (ordered) by treatment (Misoprostol, Placebo) 
chi-squared = 28.1587, df = 1, p-value = 1.118e-07

R> cmh_test(classification ~ treatment, data = Lanza,
+           scores = list(classification = c(0, 1, 6, 17, 30)),
+           subset = Lanza$study == "IV")

	Asymptotic Linear-by-Linear Association Test

data:  classification (ordered) by treatment (Misoprostol, Placebo) 
chi-squared = 15.7414, df = 1, p-value = 7.262e-05

R> 
R> 
R> ###################################################
R> ### chunk number 20: CI-Lanza-all
R> ###################################################
R> cmh_test(classification ~ treatment | study, data = Lanza,
+           scores = list(classification = c(0, 1, 6, 17, 30)))

	Asymptotic Linear-by-Linear Association Test

data:  classification (ordered) by
	 treatment (Misoprostol, Placebo) 
	 stratified by study 
chi-squared = 83.6188, df = 1, p-value < 2.2e-16

R> 
R> 
R> ###################################################
R> ### chunk number 21: CI-anomalies
R> ###################################################
R> anomalies <- c(235, 23, 3, 0, 41, 35, 8, 0,
+                 20, 11, 11, 1, 2, 1, 3, 1)
R> anomalies <- as.table(matrix(anomalies,
+      ncol = 4, dimnames = list(MD = 0:3, RA = 0:3)))
R> anomalies
   RA
MD    0   1   2   3
  0 235  41  20   2
  1  23  35  11   1
  2   3   8  11   3
  3   0   0   1   1
R> 
R> 
R> ###################################################
R> ### chunk number 22: CI-anomalies-mh
R> ###################################################
R> mh_test(anomalies)

	Asymptotic Marginal-Homogeneity Test

data:  response by
	 groups (MD, RA) 
	 stratified by block 
chi-squared = 21.2266, df = 3, p-value = 9.446e-05

R> 
R> 
R> ###################################################
R> ### chunk number 23: CI-anomalies-ordered
R> ###################################################
R> mh_test(anomalies, scores = list(c(0, 1, 2, 3)))

	Asymptotic Marginal-Homogeneity Test for Ordered Data

data:  response (ordered) by
	 groups (MD, RA) 
	 stratified by block 
chi-squared = 21.0199, df = 1, p-value = 4.545e-06

R> 
R> 
R> 
