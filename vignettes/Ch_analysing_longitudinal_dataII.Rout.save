
R version 2.9.0 (2009-04-17)
Copyright (C) 2009 The R Foundation for Statistical Computing
ISBN 3-900051-07-0

R is free software and comes with ABSOLUTELY NO WARRANTY.
You are welcome to redistribute it under certain conditions.
Type 'license()' or 'licence()' for distribution details.

R is a collaborative project with many contributors.
Type 'contributors()' for more information and
'citation()' on how to cite R or R packages in publications.

Type 'demo()' for some demos, 'help()' for on-line help, or
'help.start()' for an HTML browser interface to help.
Type 'q()' to quit R.

> ###################################################
> ### code chunk number 1: setup
> ###################################################
> rm(list = ls())
> if (!file.exists("tables")) dir.create("tables")
> set.seed(290875)
> options(prompt = "R> ", continue = "+  ",
+     width = 63, # digits = 4,
+     show.signif.stars = FALSE,
+     SweaveHooks = list(leftpar = function()
+         par(mai = par("mai") * c(1, 1.05, 1, 1)),
+         bigleftpar = function()
+         par(mai = par("mai") * c(1, 1.7, 1, 1))))
R> HSAURpkg <- require("HSAUR2")
Loading required package: HSAUR2
Loading required package: lattice
Loading required package: MASS
Loading required package: scatterplot3d
R> if (!HSAURpkg) stop("cannot load package ", sQuote("HSAUR2"))
R> rm(HSAURpkg)
R>  ### </FIXME> hm, R-2.4.0 --vanilla seems to need this
R> a <- Sys.setlocale("LC_ALL", "C")
R>  ### </FIXME>
R> book <- TRUE
R> refs <- cbind(c("AItR", "DAGD", "SI", "CI", "ANOVA", "MLR", "GLM",
+                  "DE", "RP", "GAM", "SA", "ALDI", "ALDII", "SIMC", "MA", "PCA",
+                  "MDS", "CA"), 1:18)
R> ch <- function(x) {
+      ch <- refs[which(refs[,1] == x),]
+      if (book) {
+          return(paste("Chapter~\\\\ref{", ch[1], "}", sep = ""))
+      } else {
+          return(paste("Chapter~", ch[2], sep = ""))
+      }
+  }
R> if (file.exists("deparse.R"))
+      source("deparse.R")
R> setHook(packageEvent("lattice", "attach"), function(...) {
+      lattice.options(default.theme =
+          function()
+              standard.theme("pdf", color = FALSE))
+      })
R> 
R> 
R> ###################################################
R> ### code chunk number 2: singlebook
R> ###################################################
R> book <- FALSE
R> 
R> 
R> ###################################################
R> ### code chunk number 3: setup
R> ###################################################
R> options(digits = 3)
R> if (!interactive()) {
+  print.summary.gee <- function (x, digits = NULL, quote = FALSE, prefix = "", ...)
+  {
+      if (is.null(digits))
+          digits <- options()$digits
+      else options(digits = digits)
+      cat("...")
+      cat("\nModel:\n")
+      cat(" Link:                     ", x$model$link, "\n")
+      cat(" Variance to Mean Relation:", x$model$varfun, "\n")
+      if (!is.null(x$model$M))
+          cat(" Correlation Structure:    ", x$model$corstr, ", M =",
+              x$model$M, "\n")
+      else cat(" Correlation Structure:    ", x$model$corstr, "\n")
+      cat("\n...")
+      nas <- x$nas
+      if (!is.null(nas) && any(nas))
+          cat("\n\nCoefficients: (", sum(nas), " not defined because of singularities)\n",
+              sep = "")
+      else cat("\n\nCoefficients:\n")
+      print(x$coefficients, digits = digits)
+      cat("\nEstimated Scale Parameter: ", format(round(x$scale,
+          digits)))
+      cat("\n...\n")
+      invisible(x)
+  }
+  }
R> 
R> 
R> ###################################################
R> ### code chunk number 4: ALDII-gee
R> ###################################################
R> library("gee")
R> 
R> 
R> ###################################################
R> ### code chunk number 5: ALDII-BtheB-data
R> ###################################################
R> data("BtheB", package = "HSAUR2")
R> BtheB$subject <- factor(rownames(BtheB))
R> nobs <- nrow(BtheB)
R> BtheB_long <- reshape(BtheB, idvar = "subject",
+      varying = c("bdi.2m", "bdi.3m", "bdi.5m", "bdi.8m"),
+      direction = "long")
R> BtheB_long$time <- rep(c(2, 3, 5, 8), rep(nobs, 4))
R> names(BtheB_long)[names(BtheB_long) == "treatment"] <- "trt"
R> 
R> 
R> ###################################################
R> ### code chunk number 6: ALDII-BtheB-geefit-indep
R> ###################################################
R> osub <- order(as.integer(BtheB_long$subject))
R> BtheB_long <- BtheB_long[osub,]
R> btb_gee <- gee(bdi ~ bdi.pre + trt + length + drug,
+      data = BtheB_long, id = subject, family = gaussian,
+      corstr = "independence")
Beginning Cgee S-function, @(#) geeformula.q 4.13 98/01/27
running glm to get initial regression estimate
(Intercept)     bdi.pre    trtBtheB   length>6m     drugYes 
      3.569       0.582      -3.237       1.458      -3.741 
R> 
R> 
R> ###################################################
R> ### code chunk number 7: ALDII-BtheB-geefit-ex
R> ###################################################
R> btb_gee1 <- gee(bdi ~ bdi.pre + trt + length + drug,
+      data = BtheB_long, id = subject, family = gaussian,
+      corstr = "exchangeable")
Beginning Cgee S-function, @(#) geeformula.q 4.13 98/01/27
running glm to get initial regression estimate
(Intercept)     bdi.pre    trtBtheB   length>6m     drugYes 
      3.569       0.582      -3.237       1.458      -3.741 
R> 
R> 
R> ###################################################
R> ### code chunk number 8: ALDII-BtheB-geesummary
R> ###################################################
R> summary(btb_gee)
...
Model:
 Link:                      Identity 
 Variance to Mean Relation: Gaussian 
 Correlation Structure:     Independent 

...

Coefficients:
            Estimate Naive S.E. Naive z Robust S.E. Robust z
(Intercept)    3.569     1.4833    2.41      2.2695    1.572
bdi.pre        0.582     0.0564   10.32      0.0916    6.355
trtBtheB      -3.237     1.1296   -2.87      1.7746   -1.824
length>6m      1.458     1.1380    1.28      1.4826    0.983
drugYes       -3.741     1.1766   -3.18      1.7827   -2.099

Estimated Scale Parameter:  79.3
...
R> 
R> 
R> ###################################################
R> ### code chunk number 9: ALDII-BtheB-gee1summary
R> ###################################################
R> summary(btb_gee1)
...
Model:
 Link:                      Identity 
 Variance to Mean Relation: Gaussian 
 Correlation Structure:     Exchangeable 

...

Coefficients:
            Estimate Naive S.E. Naive z Robust S.E. Robust z
(Intercept)    3.023     2.3039  1.3122      2.2320   1.3544
bdi.pre        0.648     0.0823  7.8741      0.0835   7.7583
trtBtheB      -2.169     1.7664 -1.2281      1.7361  -1.2495
length>6m     -0.111     1.7309 -0.0643      1.5509  -0.0718
drugYes       -3.000     1.8257 -1.6430      1.7316  -1.7323

Estimated Scale Parameter:  81.7
...
R> 
R> 
R> ###################################################
R> ### code chunk number 10: ALDII-respiratory-data
R> ###################################################
R> data("respiratory", package = "HSAUR2")
R> resp <- subset(respiratory, month > "0")
R> resp$baseline <- rep(subset(respiratory, month == "0")$status,
+                       rep(4, 111))
R> resp$nstat <- as.numeric(resp$status == "good")
R> resp$month <- resp$month[, drop = TRUE]
R> 
R> 
R> ###################################################
R> ### code chunk number 11: ALDII-respiratory-names
R> ###################################################
R> names(resp)[names(resp) == "treatment"] <- "trt"
R> levels(resp$trt)[2] <- "trt"
R> 
R> 
R> ###################################################
R> ### code chunk number 12: ALDII-respiratory-fit
R> ###################################################
R> resp_glm <- glm(status ~ centre + trt + gender + baseline
+      + age, data = resp, family = "binomial")
R> resp_gee1 <- gee(nstat ~ centre + trt + gender + baseline
+      + age, data = resp, family = "binomial", id = subject,
+      corstr = "independence", scale.fix = TRUE,
+      scale.value = 1)
Beginning Cgee S-function, @(#) geeformula.q 4.13 98/01/27
running glm to get initial regression estimate
 (Intercept)      centre2       trttrt   gendermale 
     -0.9002       0.6716       1.2992       0.1192 
baselinegood          age 
      1.8820      -0.0182 
R> resp_gee2 <- gee(nstat ~ centre + trt + gender + baseline
+      + age, data = resp, family = "binomial", id = subject,
+      corstr = "exchangeable", scale.fix = TRUE,
+      scale.value = 1)
Beginning Cgee S-function, @(#) geeformula.q 4.13 98/01/27
running glm to get initial regression estimate
 (Intercept)      centre2       trttrt   gendermale 
     -0.9002       0.6716       1.2992       0.1192 
baselinegood          age 
      1.8820      -0.0182 
R> 
R> 
R> ###################################################
R> ### code chunk number 13: ALDII-resp-glm-summary
R> ###################################################
R> summary(resp_glm)

Call:
glm(formula = status ~ centre + trt + gender + baseline + age, 
    family = "binomial", data = resp)

Deviance Residuals: 
   Min      1Q  Median      3Q     Max  
-2.315  -0.855   0.434   0.895   1.925  

Coefficients:
             Estimate Std. Error z value Pr(>|z|)
(Intercept)  -0.90017    0.33765   -2.67   0.0077
centre2       0.67160    0.23957    2.80   0.0051
trttrt        1.29922    0.23684    5.49  4.1e-08
gendermale    0.11924    0.29467    0.40   0.6857
baselinegood  1.88203    0.24129    7.80  6.2e-15
age          -0.01817    0.00886   -2.05   0.0404

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 608.93  on 443  degrees of freedom
Residual deviance: 483.22  on 438  degrees of freedom
AIC: 495.2

Number of Fisher Scoring iterations: 4

R> 
R> 
R> ###################################################
R> ### code chunk number 14: ALDII-resp-gee1summary
R> ###################################################
R> summary(resp_gee1)
...
Model:
 Link:                      Logit 
 Variance to Mean Relation: Binomial 
 Correlation Structure:     Independent 

...

Coefficients:
             Estimate Naive S.E. Naive z Robust S.E. Robust z
(Intercept)   -0.9002    0.33765  -2.666       0.460   -1.956
centre2        0.6716    0.23957   2.803       0.357    1.882
trttrt         1.2992    0.23684   5.486       0.351    3.704
gendermale     0.1192    0.29467   0.405       0.443    0.269
baselinegood   1.8820    0.24129   7.800       0.350    5.376
age           -0.0182    0.00886  -2.049       0.013   -1.397

Estimated Scale Parameter:  1
...
R> 
R> 
R> ###################################################
R> ### code chunk number 15: ALDII-resp-gee2-summary
R> ###################################################
R> summary(resp_gee2)
...
Model:
 Link:                      Logit 
 Variance to Mean Relation: Binomial 
 Correlation Structure:     Exchangeable 

...

Coefficients:
             Estimate Naive S.E. Naive z Robust S.E. Robust z
(Intercept)   -0.9002     0.4785  -1.881       0.460   -1.956
centre2        0.6716     0.3395   1.978       0.357    1.882
trttrt         1.2992     0.3356   3.871       0.351    3.704
gendermale     0.1192     0.4176   0.286       0.443    0.269
baselinegood   1.8820     0.3419   5.504       0.350    5.376
age           -0.0182     0.0126  -1.446       0.013   -1.397

Estimated Scale Parameter:  1
...
R> 
R> 
R> ###################################################
R> ### code chunk number 16: ALDII-resp-confint
R> ###################################################
R> se <- summary(resp_gee2)$coefficients["trttrt",
+                                        "Robust S.E."]
R> coef(resp_gee2)["trttrt"] +
+      c(-1, 1) * se * qnorm(0.975)
[1] 0.612 1.987
R> 
R> 
R> ###################################################
R> ### code chunk number 17: ALDII-resp-confint-exp
R> ###################################################
R> exp(coef(resp_gee2)["trttrt"] +
+      c(-1, 1) * se * qnorm(0.975))
[1] 1.84 7.29
R> 
R> 
R> ###################################################
R> ### code chunk number 18: ALDII-epilepsy
R> ###################################################
R> data("epilepsy", package = "HSAUR2")
R> itp <- interaction(epilepsy$treatment, epilepsy$period)
R> tapply(epilepsy$seizure.rate, itp, mean)
  placebo.1 Progabide.1   placebo.2 Progabide.2   placebo.3 
       9.36        8.58        8.29        8.42        8.79 
Progabide.3   placebo.4 Progabide.4 
       8.13        7.96        6.71 
R> tapply(epilepsy$seizure.rate, itp, var)
  placebo.1 Progabide.1   placebo.2 Progabide.2   placebo.3 
      102.8       332.7        66.7       140.7       215.3 
Progabide.3   placebo.4 Progabide.4 
      193.0        58.2       126.9 
R> 
R> 
R> ###################################################
R> ### code chunk number 19: ALDII-plot1
R> ###################################################
R> layout(matrix(1:2, nrow = 1))
R> ylim <- range(epilepsy$seizure.rate)
R> placebo <- subset(epilepsy, treatment == "placebo")
R> progabide <- subset(epilepsy, treatment == "Progabide")
R> boxplot(seizure.rate ~ period, data = placebo,
+          ylab = "Number of seizures",
+          xlab = "Period", ylim = ylim, main = "Placebo")
R> boxplot(seizure.rate ~ period, data = progabide,
+          main = "Progabide", ylab = "Number of seizures",
+          xlab = "Period", ylim = ylim)
R> 
R> 
R> ###################################################
R> ### code chunk number 20: ALDII-plot2
R> ###################################################
R> layout(matrix(1:2, nrow = 1))
R> ylim <- range(log(epilepsy$seizure.rate + 1))
R> boxplot(log(seizure.rate + 1) ~ period, data = placebo,
+          main = "Placebo", ylab = "Log number of seizures",
+          xlab = "Period", ylim = ylim)
R> boxplot(log(seizure.rate + 1) ~ period, data = progabide,
+          main = "Progabide", ylab = "Log number of seizures",
+          xlab = "Period", ylim = ylim)
R> 
R> 
R> ###################################################
R> ### code chunk number 21: ALDII-epilepsy-gee
R> ###################################################
R> per <- rep(log(2),nrow(epilepsy))
R> epilepsy$period <- as.numeric(epilepsy$period)
R> names(epilepsy)[names(epilepsy) == "treatment"] <- "trt"
R> fm <- seizure.rate ~ base + age + trt + offset(per)
R> epilepsy_glm <- glm(fm, data = epilepsy, family = "poisson")
R> epilepsy_gee1 <- gee(fm, data = epilepsy, family = "poisson",
+      id = subject, corstr = "independence", scale.fix = TRUE,
+      scale.value = 1)
Beginning Cgee S-function, @(#) geeformula.q 4.13 98/01/27
running glm to get initial regression estimate
 (Intercept)         base          age trtProgabide 
     -0.1306       0.0227       0.0227      -0.1527 
R> epilepsy_gee2 <- gee(fm, data = epilepsy, family = "poisson",
+      id = subject, corstr = "exchangeable", scale.fix = TRUE,
+      scale.value = 1)
Beginning Cgee S-function, @(#) geeformula.q 4.13 98/01/27
running glm to get initial regression estimate
 (Intercept)         base          age trtProgabide 
     -0.1306       0.0227       0.0227      -0.1527 
R> epilepsy_gee3 <- gee(fm, data = epilepsy, family = "poisson",
+      id = subject, corstr = "exchangeable", scale.fix = FALSE,
+      scale.value = 1)
Beginning Cgee S-function, @(#) geeformula.q 4.13 98/01/27
running glm to get initial regression estimate
 (Intercept)         base          age trtProgabide 
     -0.1306       0.0227       0.0227      -0.1527 
R> 
R> 
R> ###################################################
R> ### code chunk number 22: ALDII-espilepsy-glm-summary
R> ###################################################
R> summary(epilepsy_glm)

Call:
glm(formula = fm, family = "poisson", data = epilepsy)

Deviance Residuals: 
   Min      1Q  Median      3Q     Max  
-4.436  -1.403  -0.503   0.484  12.322  

Coefficients:
              Estimate Std. Error z value Pr(>|z|)
(Intercept)  -0.130616   0.135619   -0.96   0.3355
base          0.022652   0.000509   44.48  < 2e-16
age           0.022740   0.004024    5.65  1.6e-08
trtProgabide -0.152701   0.047805   -3.19   0.0014

(Dispersion parameter for poisson family taken to be 1)

    Null deviance: 2521.75  on 235  degrees of freedom
Residual deviance:  958.46  on 232  degrees of freedom
AIC: 1732

Number of Fisher Scoring iterations: 5

R> 
R> 
R> ###################################################
R> ### code chunk number 23: ALDII-espilepsy-gee1-summary
R> ###################################################
R> summary(epilepsy_gee1)
...
Model:
 Link:                      Logarithm 
 Variance to Mean Relation: Poisson 
 Correlation Structure:     Independent 

...

Coefficients:
             Estimate Naive S.E. Naive z Robust S.E. Robust z
(Intercept)   -0.1306   0.135619  -0.963     0.36515   -0.358
base           0.0227   0.000509  44.476     0.00124   18.332
age            0.0227   0.004024   5.651     0.01158    1.964
trtProgabide  -0.1527   0.047805  -3.194     0.17111   -0.892

Estimated Scale Parameter:  1
...
R> 
R> 
R> ###################################################
R> ### code chunk number 24: ALDII-espilepsy-gee2-summary
R> ###################################################
R> summary(epilepsy_gee2)
...
Model:
 Link:                      Logarithm 
 Variance to Mean Relation: Poisson 
 Correlation Structure:     Exchangeable 

...

Coefficients:
             Estimate Naive S.E. Naive z Robust S.E. Robust z
(Intercept)   -0.1306   0.200442  -0.652     0.36515   -0.358
base           0.0227   0.000753  30.093     0.00124   18.332
age            0.0227   0.005947   3.824     0.01158    1.964
trtProgabide  -0.1527   0.070655  -2.161     0.17111   -0.892

Estimated Scale Parameter:  1
...
R> 
R> 
R> ###################################################
R> ### code chunk number 25: ALDII-espilepsy-gee3-summary
R> ###################################################
R> summary(epilepsy_gee3)
...
Model:
 Link:                      Logarithm 
 Variance to Mean Relation: Poisson 
 Correlation Structure:     Exchangeable 

...

Coefficients:
             Estimate Naive S.E. Naive z Robust S.E. Robust z
(Intercept)   -0.1306    0.45220  -0.289     0.36515   -0.358
base           0.0227    0.00170  13.339     0.00124   18.332
age            0.0227    0.01342   1.695     0.01158    1.964
trtProgabide  -0.1527    0.15940  -0.958     0.17111   -0.892

Estimated Scale Parameter:  5.09
...
R> 
R> 
R> 
